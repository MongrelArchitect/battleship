(()=>{"use strict";function e(){const e={},t=[],r=[],o=[],a=e=>{for(let t=0;t<e.length;t+=1)if(e[t][0]>9||e[t][0]<0||e[t][1]>9||e[t][1]<0)return!0;return!1},c=(t,r,o)=>{const c=((e,t,r)=>{const o=[t];for(let a=1;a<e;a+=1)"vert"===r?o.push([t[0],t[1]-a]):o.push([t[0]+a,t[1]]);return o})(t,r,o);if(!a(c)&&!(t=>{const r=Object.keys(e);for(let o=0;o<r.length;o+=1){const a=e[r[o]].coord;for(let e=0;e<a.length;e+=1)for(let r=0;r<t.length;r+=1)if(t[r][0]===a[e][0]&&t[r][1]===a[e][1])return!0}return!1})(c)){const r=Object.keys(e).length;e[r]={},e[r].ship=function(e){let t=0;return{hit:()=>{t<e&&(t+=1)},isSunk:()=>t===e}}(t),e[r].coord=c}};function n(e){const o=[[e[0],e[1]+1],[e[0]-1,e[1]],[e[0],e[1]-1],[e[0]+1,e[1]]],c=[];for(let e=0;e<o.length;e+=1)a([o[e]])||c.push(o[e]);return c.filter((e=>{let r=!0;return t.forEach((t=>{t[0]===e[0]&&t[1]===e[1]&&(r=!1)})),r})).filter((e=>{let t=!0;return r.forEach((r=>{r[0]===e[0]&&r[1]===e[1]&&(t=!1)})),t}))}return{hits:t,board:e,placeShip:c,receiveAttack:a=>{let c=!1;const s=Object.keys(e);for(let r=0;r<s.length&&!c;r+=1){const l=e[s[r]],d=l.coord;for(let e=0;e<d.length;e+=1)if(d[e][0]===a[0]&&d[e][1]===a[1]){l.ship.hit(),t.push(a),n(a).forEach((e=>{o.push(e)})),c=!0;break}}c||r.push(a)},misses:r,allSunk:()=>{const t=Object.keys(e),r=t.length;if(!r)return!1;let o=0;for(let a=0;a<r;a+=1)e[t[a]].ship.isSunk()&&(o+=1);return o===r},potentialTargets:o,setupComputer:()=>{const t=()=>Math.floor(2*Math.random())?"vert":"horz",r=()=>[Math.floor(10*Math.random()),Math.floor(10*Math.random())];for(;0===Object.keys(e).length;)c(5,r(),t());for(;1===Object.keys(e).length;)c(4,r(),t());for(;2===Object.keys(e).length;)c(3,r(),t());for(;3===Object.keys(e).length;)c(3,r(),t());for(;4===Object.keys(e).length;)c(2,r(),t())}}}function t(e,t){const{hits:r}=t,{misses:o}=t;for(let t=0;t<r.length;t+=1)if(r[t][0]===e[0]&&r[t][1]===e[1])return!0;for(let t=0;t<o.length;t+=1)if(o[t][0]===e[0]&&o[t][1]===e[1])return!0;return!1}function r(){return{attack:(e,r=function(e){const{potentialTargets:r}=e;let o=[];if(r.length)o=[...r[0]],r.shift();else for(o=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];t(o,e);)o[0]=Math.floor(10*Math.random()),o[1]=Math.floor(10*Math.random());return o}(e))=>(e.receiveAttack(r),r),gameboard:e()}}function o(e,t){let r;r=t?"#setup-board":"#player-board",document.querySelector(r).querySelectorAll(".grid-cell").forEach((t=>{const r=+t.dataset.coords[1],o=+t.dataset.coords[4];Object.keys(e.board).forEach((a=>{e.board[a].coord.forEach((e=>{e[0]===r&&e[1]===o&&t.classList.add("ship")}))}))}))}function a(e,t,r){const o=document.querySelector(r).querySelector(`.grid-cell[data-coords="[${t[0]}, ${t[1]}]"]`);let a=!1;for(let r=0;r<e.length;r+=1)e[r][0]===t[0]&&e[r][1]===t[1]&&(a=!0);a?o.classList.add("hit"):o.classList.add("miss")}function c(e){const t=document.querySelector(".grayout");document.querySelector(".game-over").classList.add("visible"),t.classList.add("visible"),document.querySelector(".winner").textContent=e,document.querySelector("#reset").addEventListener("click",(()=>{window.location.reload()}))}function n(){const e=document.querySelector("#setup-board").querySelectorAll(".grid-cell");for(let t=0;t<e.length;t+=1)e[t].classList.remove("placing")}!function(){const e=r();document.querySelectorAll(".gameboard").forEach((e=>{for(let t=9;t>=0;t-=1)for(let r=0;r<10;r+=1){const o=document.createElement("div");o.className="grid-cell",o.setAttribute("data-coords",`[${r}, ${t}]`),e.appendChild(o)}})),function(e){const t=document.querySelector(".ship-name");t.textContent="Carrier";let r="vert",a=5;document.querySelector("#rotate").addEventListener("click",(()=>{r="vert"===r?"horz":"vert"}));const c=document.querySelector("#setup-board");c.querySelectorAll(".grid-cell").forEach((s=>{s.addEventListener("mouseover",(()=>{if(Object.keys(e.gameboard.board).length<5){s.classList.add("placing");const e=+s.dataset.coords[1],t=+s.dataset.coords[4];for(let o=1;o<a;o+=1){let a;a="vert"===r?c.querySelector(`.grid-cell[data-coords="[${e}, ${t-o}]"]`):c.querySelector(`.grid-cell[data-coords="[${e+o}, ${t}]"]`),a&&a.classList.add("placing")}}})),s.addEventListener("mouseout",(()=>{const e=+s.dataset.coords[1],t=+s.dataset.coords[4];s.classList.remove("placing");for(let o=1;o<a;o+=1){let a;a="vert"===r?c.querySelector(`.grid-cell[data-coords="[${e}, ${t-o}]"]`):c.querySelector(`.grid-cell[data-coords="[${e+o}, ${t}]"]`),a&&a.classList.remove("placing")}})),s.addEventListener("click",(()=>{if(Object.keys(e.gameboard.board).length<5){const c=+s.dataset.coords[1],l=+s.dataset.coords[4];switch(e.gameboard.placeShip(a,[c,l],r),Object.keys(e.gameboard.board).length){case 1:a=4,t.textContent="Battleship",n(),o(e.gameboard,!0);break;case 2:a=3,t.textContent="Cruiser",n(),o(e.gameboard,!0);break;case 3:a=3,t.textContent="Submarine",n(),o(e.gameboard,!0);break;case 4:a=2,t.textContent="Destroyer",n(),o(e.gameboard,!0);break;default:n(),o(e.gameboard,!0),o(e.gameboard),function(){const e=document.querySelector("#play");e.removeAttribute("disabled"),e.addEventListener("click",(()=>{const e=document.querySelector(".grayout");document.querySelector(".setup").classList.remove("visible"),e.classList.remove("visible")}))}()}}}))}))}(e);const t=r();t.gameboard.setupComputer(),function(e,t){const{gameboard:r}=e;document.querySelector("#computer-board").querySelectorAll(".grid-cell").forEach((o=>{const n=+o.dataset.coords[1],s=+o.dataset.coords[4];o.addEventListener("click",(()=>{(function(e,t,r){for(let t=0;t<e.length;t+=1)if(e[t][0]===r[0]&&e[t][1]===r[1])return!0;for(let e=0;e<t.length;e+=1)if(t[e][0]===r[0]&&t[e][1]===r[1])return!0;return!1})(r.hits,r.misses,[n,s])||(a(r.hits,t.attack(r,[n,s]),"#computer-board"),r.allSunk()?c("You"):(a(t.gameboard.hits,e.attack(t.gameboard),"#player-board"),t.gameboard.allSunk()&&c("Computer")))}))}))}(t,e)}()})();